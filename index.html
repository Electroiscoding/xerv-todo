<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Todo Alarm PWA</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f172a" />
  <link rel="icon" href="icons/icon-192.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => console.log('SW registered'));
    }
    Notification.requestPermission();
  </script>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col items-center p-4">
  <h1 class="text-2xl font-bold mb-4">ðŸ”” Todo + Alarm</h1>
  <form id="todo-form" class="w-full max-w-md space-y-2">
    <input id="todo-text" type="text" placeholder="Task..." class="w-full p-2 text-black rounded" required />
    <input id="todo-time" type="datetime-local" class="w-full p-2 text-black rounded" required />
    <button type="submit" class="w-full bg-blue-600 py-2 rounded hover:bg-blue-700">Add Task + Set Alarm</button>
  </form>
  <ul id="todo-list" class="mt-6 w-full max-w-md space-y-3"></ul>

  <script>
    const todoForm = document.getElementById('todo-form');
    const todoText = document.getElementById('todo-text');
    const todoTime = document.getElementById('todo-time');
    const todoList = document.getElementById('todo-list');

    let todos = JSON.parse(localStorage.getItem('todos') || '[]');

    function saveAndRender() {
      localStorage.setItem('todos', JSON.stringify(todos));
      render();
    }

    function render() {
      todoList.innerHTML = '';
      todos.forEach((todo, i) => {
        const li = document.createElement('li');
        li.className = 'bg-slate-800 p-2 rounded flex justify-between items-center';
        li.innerHTML = `
          <div>
            <p>${todo.text}</p>
            <small class="text-gray-400">${new Date(todo.time).toLocaleString()}</small>
          </div>
          <button onclick="removeTodo(${i})" class="text-red-400 hover:text-red-600">âœ•</button>
        `;
        todoList.appendChild(li);
      });
    }

    function removeTodo(index) {
      todos.splice(index, 1);
      saveAndRender();
    }

    function notify(title, body) {
      if (Notification.permission === 'granted') {
        new Notification(title, { body });
      }
    }

    function scheduleAlarm(task) {
      const delay = new Date(task.time).getTime() - Date.now();
      if (delay > 0) {
        setTimeout(() => {
          notify('â° Task Reminder', task.text);
        }, delay);
      }
    }

    todoForm.onsubmit = e => {
      e.preventDefault();
      const text = todoText.value.trim();
      const time = todoTime.value;

      if (!text || !time) return;

      const task = { text, time };
      todos.push(task);
      scheduleAlarm(task);
      saveAndRender();

      todoText.value = '';
      todoTime.value = '';
    };

    // Schedule alarms on load
    todos.forEach(scheduleAlarm);
    render();
  </script>
</body>
</html>
